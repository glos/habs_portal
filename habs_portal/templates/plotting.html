{% extends "base.html" %}
{% block title %}
    <title>HABS Data Portal</title>
{% endblock %}
{% block head %}

<!-- Partials -->
<script src="/js/partials/compiled/plotting.js" type="text/javascript"></script>

<!-- Scripts -->
<script src="/js/compiled/plotting.js" type="text/javascript"></script>

<!-- CSS -->
<link href="/css/compiled/plotting.css" rel="stylesheet" type="text/css">
{% endblock %}
{% block body %}

<div id="banner">
</div>
<div id="navbar">
</div>
<div id="wrapper">
  <div id="sidebar-wrapper">
    <div id="toc">
    </div>
  </div>
  <div id="page-content-wrapper">
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-12">
          <div class="plotting-row1">
            <div class="panel panel-default full-height">
              <div class="panel-body full-height">
                <div class="row">
                  <div id="timeseries-container" class="col-md-12">
                    <div id="timeseries-view" class="panel-body full-height">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-12 text-center">
                    <button type="button" class="btn btn-primary btn-xs">
                      <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Toledo Low Service - Temperature (C)
                    </button>
                    &nbsp;&nbsp;
                    <button type="button" class="btn btn-success btn-xs">
                      <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Toledo Water Intake Crib - Temperature (C)
                    </button>
                    &nbsp;&nbsp;
                    <button type="button" class="btn btn-danger btn-xs">
                      <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> OSU SBI - Temperature (C)
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row plotting-row2">
        <div class="col-md-12 plotting-row2">
          <div id="data-view" class="full-height">
            <div class="panel panel-default full-height">
              <div class="panel-body">
                <table class="table table-striped table-hover">
                  <thead>
                    <tr>
                      <th>Time</th><th>Toledo Low Service - Temperature (C)</th><th>Toledo Water Intake Crib - Temperature (C)</th><th>OSU SBI - Temperature (C)</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr><td>2015-03-01</td><td>25.1</td><td>25</td><td>27</td></tr>
                    <tr><td>2015-03-01</td><td>25.1</td><td>25</td><td>27</td></tr>
                    <tr><td>2015-03-01</td><td>25.1</td><td>25</td><td>27</td></tr>
                    <tr><td>2015-03-01</td><td>25.1</td><td>25</td><td>27</td></tr>
                    <tr><td>2015-03-01</td><td>25.1</td><td>25</td><td>27</td></tr>
                    <tr><td>2015-03-01</td><td>25.1</td><td>25</td><td>27</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
  </div> <!-- #page-content-wrapper -->
</div> <!-- #wrapper -->

<script type="text/javascript">
var App = function() {
}

_.extend(App.prototype, Backbone.Events, {
  views: {
    bannerVeiw: null,
    navbarView: null,
    tocView: null,
    timeseriesView: null
  },
  models: {
  },
  collections: {
    stations: null,
    activeStations: null
  },
  start: function() {
    var self = this;

    /* Collections */
    this.collections.categories = new CategoryCollection();
    this.collections.categoriesNoStations = new CategoryCollection();
    this.collections.institutions = new InstitutionCollection();
    this.collections.stations = new StationCollection();

    /* Views */
    this.views.bannerView = new BannerView({
      el: $('#banner')
    }).render();

    this.views.navbarView = new NavbarView({
      el: $('#navbar'),
      mode: 'plotting'
    }).render();

    this.views.tocView = new TOCView({
      el: $('#toc'),
      parentCollection: this.collections.stations,
      childCollection: this.collections.categoriesNoStations,
      parentChildAssociation: function(parent,child) {
        return _.indexOf(parent.get('categories'),child.get('id')) >= 0
      }
    });

    this.views.timeseriesView = new TimeseriesView({
      el: $('#timeseries-view'),
    }).render();

    /* Event Listeners */

    /* stations:reset */
    this.listenTo(this.collections.stations, 'reset', function(collection) {
      self.collections.categoriesNoStations.reset(self.collections.categories.filter(function(o){return o.get('name') != 'Stations'}));
      self.views.tocView.render();
    });

    /* tocChildItemView:onTOCChildSelect */
    this.listenTo(this, 'tocChildItemView:onTOCChildSelect', function(model) {
      // the child in this case is a category
      console.log('tocChildItemView:onTOCChildSelect: ' + model.get('id'));
    });

    /* timeseriesView:onRefreshClick */
    this.listenTo(this, 'timeseriesView:onRefreshClick', function(model, options) {
      // FIXME.  No model here yet.
      console.log('timeseriesView:onRefreshClick: from ' + options.start + ' to ' + options.end);
    });

    /* Fetching */
    this.collections.categories.fetch({reset: true});
    this.collections.stations.fetch({reset: true});
    this.collections.institutions.fetch({reset: true});
  }
});

app = new App();
$(document).ready(function() {
  app.start();
});

</script>
{% endblock %}
